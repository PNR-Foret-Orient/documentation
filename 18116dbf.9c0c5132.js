(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{56:function(e,r,t){"use strict";t.r(r),t.d(r,"frontMatter",(function(){return o})),t.d(r,"metadata",(function(){return s})),t.d(r,"rightToc",(function(){return c})),t.d(r,"default",(function(){return d}));var n=t(2),a=t(6),u=(t(0),t(85)),i=t(86),o={title:"Sauvegardes"},s={unversionedId:"serveurSauvegardes",id:"serveurSauvegardes",isDocsHomePage:!1,title:"Sauvegardes",description:"Il y a deux \xe9l\xe9ments principaux qui doivent \xeatre sauvegard\xe9s :",source:"@site/docs/serveurSauvegardes.md",slug:"/serveurSauvegardes",permalink:"/documentation/serveurSauvegardes",editUrl:"https://github.com/PNR-Foret-Orient/documentation/edit/master/docs/serveurSauvegardes.md",version:"current",sidebar:"sidebar",previous:{title:"D\xe9pannage",permalink:"/documentation/serveurDepannage"},next:{title:"GeoNature",permalink:"/documentation/geonatureApercu"}},c=[{value:"Sauvegarder la BDD",id:"sauvegarder-la-bdd",children:[]},{value:"Sauvegarder les fichiers",id:"sauvegarder-les-fichiers",children:[]}],l={rightToc:c};function d(e){var r=e.components,t=Object(a.a)(e,["components"]);return Object(u.b)("wrapper",Object(n.a)({},l,t,{components:r,mdxType:"MDXLayout"}),Object(u.b)("p",null,"Il y a deux \xe9l\xe9ments principaux qui doivent \xeatre sauvegard\xe9s :"),Object(u.b)("ol",null,Object(u.b)("li",{parentName:"ol"},"la BDD"),Object(u.b)("li",{parentName:"ol"},"le r\xe9pertoire personnel de l'utilisateur ",Object(u.b)("inlineCode",{parentName:"li"},"geonatureadmin")," : ",Object(u.b)("inlineCode",{parentName:"li"},"/home/geonatureadmin/"))),Object(u.b)("p",null,"La BDD contient toutes les donn\xe9es de GeoNature et ses modules associ\xe9s. Le r\xe9pertoire ",Object(u.b)("inlineCode",{parentName:"p"},"/home/geonatureadmin/")," ne contient pas seulement le code source, mais aussi tous les fichiers m\xe9dias qui ont \xe9t\xe9 t\xe9l\xe9charg\xe9s. Par exemple, les images des esp\xe8ces de TaxHub se trouvent dans le chemin ",Object(u.b)("inlineCode",{parentName:"p"},"/home/geonatureadmin/taxhub/static/medias"),"."),Object(u.b)("p",null,"En dehors de ces \xe9l\xe9ments, il y a quelques fichiers de configuration, comme ceux d'",Object(u.b)("inlineCode",{parentName:"p"},"apache2")," ou ",Object(u.b)("inlineCode",{parentName:"p"},"certbot"),". Si il y a une grosse panne, par exemple de disque, il est possible de r\xe9cr\xe9er ces fichiers selon la documentation de GeoNature. Ceci n'est pas le cas avec les donn\xe9es dans la BDD !"),Object(u.b)("p",null,"M\xeame s'il y a des sauvegardes r\xe9guli\xe8res de l'ensemble du syst\xe8me, il est pr\xe9f\xe9rable de faire une une sauvegarde de la BDD avant d'ex\xe9cuter des scripts qui touchent beaucoup de donn\xe9es. Ex. les scripts de mise \xe0 jour."),Object(u.b)("p",null,"Pour en savoir plus, lire ",Object(u.b)("a",Object(n.a)({parentName:"p"},{href:"http://docs.geonature.fr/admin-manual.html#sauvegarde-et-restauration"}),"la documentation officielle"),"."),Object(u.b)("h2",{id:"sauvegarder-la-bdd"},"Sauvegarder la BDD"),Object(u.b)("p",null,"Vous pouvez effectuer une sauvegarde depuis ",Object(u.b)("inlineCode",{parentName:"p"},"DBeaver"),", ",Object(u.b)("inlineCode",{parentName:"p"},"pgadmin4")," ou un autre logiciel d'administration des BDDs."),Object(u.b)("img",{alt:"Capture d'\xe9cran du module validation",src:Object(i.a)("img/docs/serveurSauvegardes1.png"),className:"tablet"}),Object(u.b)("p",null,Object(u.b)("em",{parentName:"p"},"Exemple du processus de sauvegarde dans DBeaver")),Object(u.b)("p",null,"Si vous voulez faire une sauvegarde directement sur le serveur, il faut s'identifer en utilisateur ",Object(u.b)("inlineCode",{parentName:"p"},"postgres")," :"),Object(u.b)("pre",null,Object(u.b)("code",Object(n.a)({parentName:"pre"},{}),"sudo su postgres\npg_dump -Fc geonature2db  > <chemin_de_sauvegarde>\n")),Object(u.b)("p",null,":::ATTENTION\nLa BDD de l'Atlas ",Object(u.b)("inlineCode",{parentName:"p"},"geonatureatlas")," est differente de GeoNature, elle n'est donc pas incluse dans une sauvegarde de la BDD ",Object(u.b)("inlineCode",{parentName:"p"},"geonature2db"),". En th\xe9orie ce n'est pas un probl\xe8me parce que les vues de l'Atlas (BDD fille) sont cr\xe9\xe9es \xe0 paritr de la BDD m\xe9re ",Object(u.b)("inlineCode",{parentName:"p"},"geonature2db"),". En cas de probl\xe8me vous pouvez les r\xe9g\xe9n\xe9rer.\n:::"),Object(u.b)("h2",{id:"sauvegarder-les-fichiers"},"Sauvegarder les fichiers"),Object(u.b)("p",null,"Vous pouvez sauvegarder presque tous les fichies avec les commandes suivantes :"),Object(u.b)("pre",null,Object(u.b)("code",Object(n.a)({parentName:"pre"},{}),'sudo su - geonatureadmin\ntar --exclude "./.node-gyp" --exclude "./.nvm" --exclude "./.npm" --exclude "./.local" --exclude "./.cache" --exclude "tmp" --exclude "site-packages" --exclude "node_modules" --exclude "./backup" -zcvf /home/`whoami`/backup/`date +%Y%m%d%H%M`.tar.gz ./\n')),Object(u.b)("p",null,"Certains fichiers sont exclus, comme ceux du cache, des paquets et des biblioth\xe8ques qu'on peut t\xe9l\xe9charger \xe0 nouveau."))}d.isMDXComponent=!0},84:function(e,r,t){"use strict";var n=t(0),a=t(20);r.a=function(){var e=Object(n.useContext)(a.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},85:function(e,r,t){"use strict";t.d(r,"a",(function(){return d})),t.d(r,"b",(function(){return m}));var n=t(0),a=t.n(n);function u(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){u(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r){if(null==e)return{};var t,n,a=function(e,r){if(null==e)return{};var t,n,a={},u=Object.keys(e);for(n=0;n<u.length;n++)t=u[n],r.indexOf(t)>=0||(a[t]=e[t]);return a}(e,r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(n=0;n<u.length;n++)t=u[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=a.a.createContext({}),l=function(e){var r=a.a.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):o(o({},r),e)),t},d=function(e){var r=l(e.components);return a.a.createElement(c.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return a.a.createElement(a.a.Fragment,{},r)}},b=a.a.forwardRef((function(e,r){var t=e.components,n=e.mdxType,u=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=l(t),b=n,m=d["".concat(i,".").concat(b)]||d[b]||p[b]||u;return t?a.a.createElement(m,o(o({ref:r},c),{},{components:t})):a.a.createElement(m,o({ref:r},c))}));function m(e,r){var t=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var u=t.length,i=new Array(u);i[0]=b;var o={};for(var s in r)hasOwnProperty.call(r,s)&&(o[s]=r[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var c=2;c<u;c++)i[c]=t[c];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"},86:function(e,r,t){"use strict";t.d(r,"b",(function(){return u})),t.d(r,"a",(function(){return i}));var n=t(84),a=t(87);function u(){var e=Object(n.a)().siteConfig,r=(e=void 0===e?{}:e).baseUrl,t=void 0===r?"/":r,u=e.url;return{withBaseUrl:function(e,r){return function(e,r,t,n){var u=void 0===n?{}:n,i=u.forcePrependBaseUrl,o=void 0!==i&&i,s=u.absolute,c=void 0!==s&&s;if(!t)return t;if(t.startsWith("#"))return t;if(Object(a.b)(t))return t;if(o)return r+t;var l=!t.startsWith(r)?r+t.replace(/^\//,""):t;return c?e+l:l}(u,t,e,r)}}}function i(e,r){return void 0===r&&(r={}),(0,u().withBaseUrl)(e,r)}},87:function(e,r,t){"use strict";function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function a(e){return void 0!==e&&!n(e)}t.d(r,"b",(function(){return n})),t.d(r,"a",(function(){return a}))}}]);